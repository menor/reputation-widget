// get facility-id from params
// Select svg based on browser language
// call the api for the feedback rating
// integrate the text in the svg
// change the color palette from a param
// contain globals into an object
// 'package' the code (base64 encoding of the svg?)

// globals (put this in an object)

// getting the language does not work
var lang = navigator.language || navigator.userLanguage

var palettes = {
  darkBlue: {
    medium: '#3E4862',
    dark: '#333B4F',
    darker: '#293140'
  },
  lightBlue: {
    medium: '#00A7C4',
    dark: '#018EA6',
    darker: '#047D92'
  },
  yellow: {
    medium: '#F8C150',
    dark: '#D7A43B',
    darker: '#B0842B'
  }
}

// Next 2 values should be passed as params
var facilityId = 'the-fish'
var palette = palettes.lightBlue

// Initialize function
function ready(fn) {
  if (document.readyState != 'loading'){
    fn();
  } else {
    document.addEventListener('DOMContentLoaded', fn);
  }
}

function replaceElement() {
  var el = document.getElementById('resmio-badge')
  // The svg should come from a file depending on the language
  // Still not sure how to do this, we can also put all the languages in the svg
  // and show or hide the elements through css
  el.innerHTML = (
    `<svg width="201" height="229" viewBox="4479 -920 201 229" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <defs>
        <rect id="a" x="15.543" y="124.148" width="172.751" height="40.153" rx="2"/>
        <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="b">
          <feOffset dy="2" in="SourceAlpha" result="shadowOffsetOuter1"/>
          <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"/>
          <feComposite in="shadowBlurOuter1" in2="SourceAlpha" operator="out" result="shadowBlurOuter1"/>
          <feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.149230072 0" in="shadowBlurOuter1"/>
        </filter>
        <mask id="c" x="0" y="0" width="172.751" height="40.153" fill="#fff">
          <use xlink:href="#a"/>
        </mask>
      </defs>
      <path id="scroll-torn" fill="${palette.dark}" d="M4624.566-749.02l41.51-7.328h-35.734M4537.123-748.916l-41.408-7.323 37.614.49"/>
      <path id="badge-back"  stroke="${palette.dark}" fill="${palette.medium}" d="M4514.67-772.657c-31.358-49.108-23.974-85.518-23.974-85.518l89.878-50.655 88.562 49.668s7.383 36.41-23.976 85.518c-31.358 49.108-65.146 70.45-65.146 70.45s-33.984-20.355-65.343-69.463z"/>
      <path id="badge-fill"  stroke="${palette.dark}" fill="#FFF" d="M4522.537-777.1c-27.977-43.787-21.39-76.252-21.39-76.252l80.186-45.168 79.01 44.288s6.588 32.465-21.39 76.253c-27.976 43.79-58.948 62.81-58.948 62.81s-29.49-18.14-57.468-61.93z"/>
      <path id="legend-back" fill="${palette.darker}" d="M4524.35-755.835l17.49 19.803h75.383l16.852-19.803"/>
      <path id="powered-by-resmio" fill="#FFF" d="M4545.89-749.113c0 .636-.216 1.126-.65 1.468-.435.343-1.056.514-1.865.514h-.74v2.47h-.73v-6.285h1.63c1.57 0 2.356.61 2.356 1.832zm-3.254 1.354h.658c.647 0 1.116-.103 1.406-.313.29-.21.434-.544.434-1.006 0-.414-.136-.724-.41-.928-.27-.203-.695-.305-1.27-.305h-.818v2.554zm8.53.74c0 .77-.193 1.37-.58 1.8-.387.432-.922.647-1.604.647-.42 0-.795-.1-1.122-.296-.327-.197-.58-.48-.757-.85-.178-.37-.266-.803-.266-1.3 0-.767.192-1.366.576-1.794.384-.43.917-.643 1.6-.643.66 0 1.182.22 1.57.658.39.44.583 1.033.583 1.78zm-3.59 0c0 .603.12 1.06.36 1.377.242.315.596.473 1.063.473.467 0 .82-.157 1.064-.47.242-.315.363-.774.363-1.38 0-.598-.12-1.053-.363-1.364-.243-.31-.6-.467-1.073-.467-.466 0-.82.152-1.057.46-.238.306-.357.763-.357 1.37zm8.69 2.36l-.864-2.763c-.055-.17-.156-.554-.306-1.153h-.034c-.115.502-.215.89-.3 1.16l-.89 2.757h-.827l-1.285-4.71h.748l.694 2.703c.16.62.25 1.037.273 1.252h.035c.03-.164.082-.375.153-.635.07-.26.13-.465.182-.617l.864-2.704h.773l.843 2.703c.16.493.27.908.327 1.243h.034c.012-.103.043-.262.093-.477.05-.216.35-1.373.896-3.47h.74l-1.303 4.71h-.847zm4.992.087c-.697 0-1.246-.212-1.65-.636-.402-.423-.603-1.012-.603-1.766 0-.76.187-1.363.56-1.81.375-.448.878-.67 1.508-.67.59 0 1.058.193 1.402.58.344.39.516.902.516 1.54v.45h-3.245c.014.553.154.973.42 1.26.264.287.637.43 1.12.43.506 0 1.008-.106 1.504-.318v.636c-.253.11-.492.187-.717.234-.225.048-.497.07-.815.07zm-.193-4.287c-.38 0-.68.124-.906.37-.226.247-.358.588-.398 1.024h2.464c0-.45-.1-.795-.3-1.035-.202-.24-.49-.36-.86-.36zm5.293-.597c.21 0 .397.017.563.05l-.098.664c-.195-.043-.367-.065-.516-.065-.38 0-.707.155-.978.464-.27.31-.407.696-.407 1.157v2.528h-.712v-4.71h.59l.08.872h.035c.175-.307.385-.544.632-.71.246-.166.517-.25.813-.25zm3.435 4.884c-.696 0-1.246-.212-1.65-.636-.402-.423-.603-1.012-.603-1.766 0-.76.187-1.363.56-1.81.375-.448.878-.67 1.508-.67.59 0 1.058.193 1.402.58.344.39.516.902.516 1.54v.45h-3.246c.014.553.154.973.42 1.26.264.287.637.43 1.12.43.506 0 1.008-.106 1.504-.318v.636c-.252.11-.49.187-.716.234-.225.048-.497.07-.815.07zm-.193-4.287c-.38 0-.68.124-.905.37-.225.247-.358.588-.398 1.024h2.464c0-.45-.1-.795-.3-1.035-.2-.24-.488-.36-.86-.36zm6.35 3.57h-.038c-.33.478-.823.717-1.48.717-.616 0-1.095-.21-1.438-.632-.342-.42-.514-1.02-.514-1.797 0-.777.172-1.38.516-1.81.344-.43.823-.645 1.437-.645.64 0 1.13.232 1.47.696h.056l-.03-.34-.018-.33v-1.92h.713v6.69h-.58l-.095-.63zm-1.427.12c.487 0 .84-.133 1.06-.398.22-.265.33-.693.33-1.284v-.15c0-.668-.112-1.145-.335-1.43-.222-.285-.576-.428-1.064-.428-.418 0-.74.163-.96.488-.223.326-.334.785-.334 1.38 0 .6.11 1.055.33 1.362.222.306.546.46.973.46zm8.096-4.28c.62 0 1.1.213 1.442.636.342.422.514 1.02.514 1.795 0 .775-.173 1.376-.518 1.805-.346.428-.825.642-1.44.642-.305 0-.586-.056-.84-.17-.253-.113-.466-.287-.638-.522h-.05l-.152.606h-.512v-6.69h.714v1.626c0 .364-.01.69-.034.98h.034c.333-.47.826-.705 1.48-.705zm-.104.6c-.487 0-.838.14-1.053.418-.215.28-.323.75-.323 1.413s.11 1.137.33 1.422c.222.285.576.428 1.063.428.44 0 .766-.16.98-.48.216-.32.323-.78.323-1.378 0-.613-.107-1.07-.322-1.37-.215-.302-.548-.453-.998-.453zm2.56-.52h.764l1.032 2.686c.226.614.367 1.056.42 1.33h.036c.037-.147.115-.398.234-.752.12-.354.508-1.442 1.167-3.265h.765l-2.025 5.365c-.2.53-.435.906-.703 1.13-.27.22-.597.332-.987.332-.218 0-.433-.025-.645-.073v-.572c.157.034.334.05.53.05.49 0 .84-.274 1.048-.824l.262-.67-1.9-4.74zm9.62-.087c.21 0 .398.017.565.05l-.098.664c-.195-.043-.367-.065-.516-.065-.38 0-.707.155-.978.464-.27.31-.407.696-.407 1.157v2.528h-.712v-4.71h.59l.08.872h.035c.175-.307.385-.544.632-.71.246-.166.517-.25.812-.25zm3.437 4.884c-.697 0-1.246-.212-1.65-.636-.402-.423-.603-1.012-.603-1.766 0-.76.187-1.363.56-1.81.375-.448.877-.67 1.508-.67.59 0 1.058.193 1.402.58.344.39.516.902.516 1.54v.45h-3.247c.014.553.154.973.42 1.26.264.287.637.43 1.12.43.506 0 1.008-.106 1.504-.318v.636c-.253.11-.49.187-.716.234-.225.048-.497.07-.815.07zm-.194-4.287c-.38 0-.68.124-.906.37-.225.247-.357.588-.397 1.024h2.463c0-.45-.1-.795-.3-1.035-.2-.24-.488-.36-.86-.36zm6.183 2.916c0 .438-.164.777-.49 1.014-.327.238-.786.357-1.377.357-.624 0-1.112-.1-1.46-.296v-.662c.225.115.468.205.727.27.26.067.51.1.75.1.373 0 .66-.06.86-.178.2-.12.302-.3.302-.544 0-.184-.08-.34-.24-.47-.158-.13-.468-.285-.93-.463-.44-.164-.75-.306-.935-.428-.185-.122-.323-.26-.413-.415-.09-.155-.135-.34-.135-.555 0-.384.156-.687.468-.91.313-.22.74-.332 1.286-.332.507 0 1.003.103 1.488.31l-.254.58c-.473-.195-.902-.293-1.286-.293-.338 0-.593.053-.765.16-.173.106-.26.252-.26.438 0 .126.033.234.098.323.064.09.168.174.31.254.145.08.42.197.827.35.56.202.937.407 1.133.613.196.207.295.466.295.78zm7.167 1.285v-3.064c0-.376-.08-.658-.24-.845-.16-.187-.41-.28-.75-.28-.443 0-.77.127-.983.382-.212.255-.318.648-.318 1.178v2.63h-.715v-3.064c0-.376-.08-.658-.24-.845-.162-.187-.412-.28-.753-.28-.448 0-.775.133-.983.4-.21.27-.313.708-.313 1.32v2.47h-.713v-4.71h.58l.116.644h.034c.135-.23.325-.41.57-.538.245-.13.52-.193.824-.193.736 0 1.218.266 1.444.8h.035c.14-.247.344-.442.61-.585.267-.144.57-.215.912-.215.532 0 .93.137 1.196.41.265.274.398.712.398 1.314v3.074h-.714zm2.898 0h-.713v-4.71h.713v4.71zm-.774-5.988c0-.164.04-.283.12-.36.08-.075.18-.113.302-.113.114 0 .213.037.296.115.084.077.125.196.125.357 0 .16-.04.28-.125.36-.083.078-.182.117-.296.117-.12 0-.22-.04-.3-.12-.08-.078-.122-.198-.122-.358zm6.355 3.63c0 .767-.194 1.367-.58 1.798-.388.432-.923.647-1.605.647-.42 0-.795-.1-1.122-.296-.327-.197-.58-.48-.757-.85-.178-.37-.266-.803-.266-1.3 0-.767.192-1.366.576-1.794.384-.43.917-.643 1.6-.643.66 0 1.182.22 1.57.658.39.44.583 1.033.583 1.78zm-3.59 0c0 .6.12 1.06.36 1.375.24.315.595.473 1.062.473.468 0 .822-.157 1.065-.47.242-.315.363-.774.363-1.38 0-.598-.12-1.053-.363-1.364-.243-.31-.6-.467-1.073-.467-.467 0-.82.152-1.058.46-.238.306-.357.763-.357 1.37z"/>
      <g id="scroll-main" transform="translate(4479 -920)">
        <use fill="#000" filter="url(#b)" xlink:href="#a"/>
        <use fill="${palette.medium}" stroke="${palette.dark}" stroke-width="2" mask="url(#c)" xlink:href="#a"/>
      </g>
      <path id="POSITIVE" fill="#FFF" d="M4572.253-778.765c0 1.61-.527 2.846-1.583 3.704-1.055.858-2.557 1.287-4.506 1.287h-1.605V-768h-2.523v-15.43h4.443c1.928 0 3.372.394 4.333 1.182.96.788 1.44 1.95 1.44 3.483zm-7.694 2.87h1.34c1.294 0 2.244-.225 2.85-.675.604-.45.907-1.154.907-2.11 0-.887-.27-1.55-.813-1.985-.542-.436-1.386-.654-2.533-.654h-1.75v5.426zm24.474.16c0 2.51-.628 4.463-1.884 5.856-1.256 1.395-3.034 2.09-5.335 2.09-2.33 0-4.118-.69-5.367-2.073-1.248-1.382-1.873-3.347-1.873-5.894s.628-4.503 1.884-5.868c1.255-1.365 3.047-2.048 5.376-2.048 2.294 0 4.067.693 5.32 2.08 1.252 1.386 1.878 3.338 1.878 5.857zm-11.778 0c0 1.9.383 3.34 1.15 4.32.767.982 1.903 1.473 3.41 1.473 1.498 0 2.63-.485 3.392-1.456.764-.97 1.145-2.417 1.145-4.338 0-1.893-.378-3.328-1.134-4.306-.758-.978-1.885-1.467-3.384-1.467-1.513 0-2.654.49-3.425 1.468-.77.978-1.154 2.413-1.154 4.306zm23.99 3.545c0 1.372-.497 2.45-1.49 3.23-.99.78-2.36 1.17-4.105 1.17-1.744 0-3.172-.27-4.283-.812v-2.385c.703.33 1.45.59 2.242.78.79.19 1.528.286 2.21.286 1 0 1.736-.19 2.21-.57.476-.38.714-.89.714-1.53 0-.578-.218-1.067-.655-1.468-.437-.4-1.337-.876-2.702-1.425-1.408-.57-2.4-1.22-2.977-1.952-.576-.732-.864-1.612-.864-2.64 0-1.286.457-2.3 1.372-3.038.915-.74 2.142-1.11 3.683-1.11 1.48 0 2.95.325 4.413.972l-.802 2.057c-1.37-.577-2.596-.865-3.672-.865-.816 0-1.435.178-1.858.533-.422.355-.633.825-.633 1.41 0 .4.085.743.254 1.028.17.285.447.554.834.807.387.254 1.084.588 2.09 1.003 1.133.47 1.963.91 2.49 1.32.528.407.915.868 1.162 1.382.246.513.37 1.118.37 1.815zm2.986 4.19v-15.43h2.522V-768h-2.522zm11.926 0h-2.523v-13.266h-4.538v-2.164h11.6v2.164h-4.54V-768zm6.902 0v-15.43h2.523V-768h-2.523zm15.388-15.43h2.617l-5.403 15.43h-2.66l-5.382-15.43h2.596l3.22 9.594c.168.457.347 1.046.537 1.767.19.723.313 1.26.37 1.61.09-.534.232-1.153.422-1.857.19-.703.344-1.224.464-1.562l3.218-9.55zM4651.83-768h-8.728v-15.43h8.728v2.132h-6.205v4.2h5.815v2.11h-5.815v4.846h6.205V-768z"/>
      <path id="FEEDBACK-FROM-"  fill="${palette.medium}" d="M4535.11-831.79l-.176.917h-3.577v3.037h2.97v.904h-2.97v4.4h-1.12v-9.258h4.873zm6.89 9.26h-5.197v-9.26h5.06l-.147.917h-3.793v3.037h3.172v.958h-3.172v3.388H4542v.96zm7.63 0h-5.195v-9.26h5.06l-.147.917h-3.793v3.037h3.172v.958h-3.172v3.388h4.076v.96zm8.82-4.617c0 1.53-.35 2.68-1.052 3.455-.396.44-.812.744-1.25.91-.435.167-.99.25-1.665.25h-2.416v-9.258h1.85c.763 0 1.342.042 1.733.128.39.085.803.28 1.235.587 1.044.747 1.566 2.056 1.566 3.928zm-1.2.134c0-.728-.06-1.324-.176-1.788-.117-.464-.324-.876-.62-1.236-.29-.342-.593-.57-.912-.68-.32-.114-.74-.17-1.262-.17h-1.107v7.437h1.107c.576 0 1.055-.062 1.437-.188.383-.126.687-.387.912-.783.412-.712.62-1.576.62-2.593zm10.034 1.944c0 .514-.128.977-.385 1.39-.257.415-.61.708-1.06.88-.27.098-.547.167-.83.208-.284.04-.75.06-1.397.06h-2.39v-9.258h1.337c.9 0 1.523.013 1.87.04.346.027.64.08.883.162.477.162.86.44 1.147.83.288.39.432.82.432 1.29 0 .476-.144.89-.432 1.24-.287.352-.697.613-1.228.784.522.1.927.26 1.215.485.558.424.837 1.054.837 1.89zm-1.16-.093c0-.405-.104-.763-.31-1.073-.208-.31-.478-.498-.81-.56-.298-.064-.658-.095-1.08-.095h-1.634v3.454h1.97c.657 0 1.132-.144 1.424-.432.293-.288.44-.72.44-1.295zm-.46-4.158c0-.36-.097-.673-.29-.94-.194-.264-.448-.437-.763-.518-.206-.054-.543-.08-1.01-.08h-1.31v3.05h1.606c.495 0 .855-.055 1.08-.163.225-.11.405-.32.54-.635.1-.225.148-.464.148-.716zm10.844 6.79h-1.255l-.877-2.85h-3.455l-.89 2.85h-1.12l3.09-9.26h1.444l3.064 9.26zm-2.416-3.754l-1.417-4.535-1.458 4.536h2.875zm10.426 3.145c-.774.505-1.633.757-2.578.757-1.08 0-1.98-.41-2.7-1.228-.737-.838-1.106-2.012-1.106-3.524 0-1.377.37-2.517 1.107-3.42.74-.906 1.665-1.358 2.78-1.358.9 0 1.68.252 2.336.756l-.594.715c-.53-.388-1.115-.58-1.754-.58-1.062 0-1.822.53-2.28 1.592-.262.602-.393 1.42-.393 2.456 0 .81.1 1.462.297 1.957.234.567.57.997 1.006 1.29.436.29.93.438 1.478.438.648 0 1.25-.198 1.808-.594l.594.74zm8.523-8.65l-3.724 4.346 3.698 4.913h-1.417l-3.537-4.9 3.564-4.36h1.417zm-5.034 9.26h-1.12v-9.26h1.12v9.26zm15.723-9.26l-.176.917h-3.577v3.037h2.97v.904h-2.97v4.4h-1.12v-9.258h4.872zm7.577 9.26h-1.39c-.396-.892-1.183-2.09-2.362-3.592-.18-.234-.34-.39-.48-.465-.14-.077-.32-.12-.546-.13v4.186h-1.108v-9.26h2.16c1.07 0 1.85.197 2.335.593.612.495.918 1.143.918 1.944 0 .765-.225 1.38-.675 1.842-.45.463-1.044.694-1.782.694h-.135c.28.225.59.572.93 1.04l2.134 3.145zm-1.633-6.737c0-.305-.086-.59-.257-.85-.17-.26-.387-.445-.647-.553-.306-.126-.693-.19-1.16-.19h-1.068v3.456h.986c.774 0 1.332-.157 1.673-.472.316-.288.474-.752.474-1.39zm10.898 2.254c0 .89-.106 1.634-.317 2.228-.212.593-.556 1.106-1.033 1.538-.657.594-1.44.89-2.348.89-1.07 0-1.948-.39-2.632-1.173-.738-.846-1.107-2.07-1.107-3.67 0-1.468.33-2.627.985-3.477.657-.85 1.557-1.275 2.7-1.275 1.27 0 2.24.503 2.915 1.51.558.83.837 1.972.837 3.43zm-1.242.162c0-1.34-.148-2.322-.445-2.943-.18-.378-.443-.684-.79-.918-.346-.235-.77-.352-1.275-.352-.432 0-.828.097-1.188.29-.36.194-.625.457-.796.79-.315.594-.473 1.444-.473 2.55 0 1.477.198 2.552.594 3.227.17.288.446.526.824.715.378.19.76.284 1.148.284.73 0 1.305-.266 1.727-.797.45-.567.675-1.516.675-2.848zm12.667 4.32h-1.107l-.54-6.79c-.045-.648-.068-1.17-.068-1.566 0 .01-.045.196-.135.56-.09.364-.166.66-.23.884l-1.983 6.91h-.945l-1.836-6.573c-.27-.917-.423-1.516-.46-1.795 0 .207-.035.8-.107 1.782l-.513 6.587h-1.066l.81-9.26h1.62l1.686 6.046c.17.62.293 1.156.365 1.606.134-.674.246-1.174.336-1.498l1.74-6.154h1.634l.797 9.26zm-82.427 12.017c0 .89-.105 1.634-.317 2.228-.21.593-.556 1.106-1.032 1.538-.656.594-1.44.89-2.348.89-1.07 0-1.948-.39-2.632-1.173-.738-.846-1.107-2.07-1.107-3.67 0-1.468.33-2.627.986-3.477.656-.85 1.555-1.275 2.698-1.275 1.27 0 2.24.503 2.915 1.51.558.83.837 1.972.837 3.43zm-1.24.162c0-1.34-.15-2.322-.447-2.943-.18-.378-.443-.684-.79-.918-.346-.235-.77-.352-1.275-.352-.432 0-.828.097-1.188.29-.36.194-.625.457-.796.79-.315.594-.472 1.444-.472 2.55 0 1.477.198 2.552.593 3.227.17.288.446.526.824.715.377.19.76.284 1.146.284.73 0 1.305-.266 1.728-.797.45-.567.675-1.516.675-2.848zm10.087 1.646c0 .567-.05 1.003-.15 1.31-.098.305-.282.575-.552.81-.558.476-1.368.715-2.43.715-.71 0-1.282-.107-1.714-.323-.43-.216-.772-.554-1.024-1.013-.18-.333-.27-.814-.27-1.444v-6.64h1.093v6.235c0 .64.053 1.084.16 1.336.262.604.865.906 1.81.906.8 0 1.345-.194 1.633-.58.234-.316.35-.797.35-1.445v-6.45h1.094v6.586zm8.995 2.673h-1.39c-.396-.892-1.183-2.09-2.362-3.592-.18-.234-.34-.39-.48-.465-.14-.077-.32-.12-.546-.13v4.186h-1.107v-9.26h2.16c1.07 0 1.85.197 2.335.593.612.495.918 1.143.918 1.944 0 .765-.225 1.38-.675 1.842-.45.463-1.044.694-1.782.694h-.135c.28.225.59.572.93 1.04l2.134 3.145zm-1.633-6.737c0-.305-.087-.59-.258-.85-.17-.26-.387-.445-.647-.553-.306-.126-.693-.19-1.16-.19h-1.067v3.456h.985c.774 0 1.332-.157 1.673-.472.315-.288.473-.752.473-1.39zm13.913 6.182c-.72.468-1.588.702-2.605.702-1.18 0-2.128-.387-2.848-1.16-.765-.83-1.147-2.025-1.147-3.59 0-1.73.477-3.024 1.43-3.888.648-.586 1.454-.878 2.417-.878.98 0 1.826.305 2.537.917l-.5.688c-.7-.477-1.372-.716-2.01-.716-1.17 0-1.94.522-2.31 1.566-.24.684-.363 1.467-.363 2.35 0 1.24.216 2.176.648 2.806.207.297.52.535.938.715.418.18.853.27 1.302.27.585 0 1.076-.122 1.472-.365v-2.82h-1.863l-.215-.92h3.118v4.32zm9.116-2.12c0 .568-.05 1.004-.15 1.31-.098.306-.282.576-.552.81-.558.477-1.368.716-2.43.716-.71 0-1.282-.107-1.714-.323-.432-.216-.774-.554-1.026-1.013-.18-.333-.27-.814-.27-1.444v-6.64h1.094v6.235c0 .64.054 1.084.162 1.336.26.604.863.906 1.808.906.8 0 1.345-.194 1.633-.58.234-.316.35-.797.35-1.445v-6.45h1.094v6.586zm8.306 2.674h-5.196v-9.26h5.06l-.147.917h-3.793v3.037h3.172v.958h-3.172v3.388h4.076v.96zm8.226-2.62c0 .44-.112.857-.337 1.25-.225.39-.54.716-.945.977-.585.378-1.278.567-2.08.567-1.08 0-2.068-.28-2.968-.837l.486-.864c.738.53 1.565.797 2.483.797.622 0 1.112-.135 1.472-.405.44-.333.662-.774.662-1.323 0-.82-.554-1.395-1.66-1.728l-.932-.283c-.81-.242-1.358-.516-1.646-.822-.387-.414-.58-.918-.58-1.512 0-.792.274-1.433.823-1.923.547-.49 1.272-.736 2.172-.736.98 0 1.912.297 2.794.89l-.486.797c-.45-.288-.84-.49-1.168-.607-.328-.117-.69-.176-1.086-.176-.576 0-1.028.136-1.357.406-.33.27-.493.644-.493 1.12 0 .37.12.67.357.898.24.23.632.434 1.18.614l1.067.338c.748.234 1.293.544 1.635.93.405.46.607 1.004.607 1.634zm7.686-6.64l-.068.93h-2.51v8.33h-1.066v-8.33h-2.484v-.93h6.128zm7.348 6.64c0 .44-.112.857-.337 1.25-.226.39-.54.716-.946.977-.585.378-1.278.567-2.078.567-1.08 0-2.07-.28-2.97-.837l.486-.864c.738.53 1.566.797 2.484.797.62 0 1.11-.135 1.47-.405.442-.333.662-.774.662-1.323 0-.82-.553-1.395-1.66-1.728l-.93-.283c-.81-.242-1.36-.516-1.648-.822-.387-.414-.58-.918-.58-1.512 0-.792.274-1.433.823-1.923.55-.49 1.273-.736 2.173-.736.98 0 1.912.297 2.794.89l-.486.797c-.45-.288-.84-.49-1.168-.607-.328-.117-.69-.176-1.086-.176-.576 0-1.028.136-1.357.406-.328.27-.492.644-.492 1.12 0 .37.12.67.36.898.237.23.63.434 1.18.614l1.066.338c.747.234 1.29.544 1.633.93.404.46.606 1.004.606 1.634z"/>
      <g id="tray">
        <path id="tray-base" fill="#018EA6" d="M4600.003-856.47h-42.922c-3.19 0-2.706 3.485 1.418 3.485H4602.453c4.123 0 4.22-3.485 1.417-3.485h-3.867z"/>
        <path id="tray-cover" fill="#DDD" d="M4585.475-877.458c.445-.486.74-1.1.8-1.802.15-1.717-1.136-3.225-2.874-3.377-1.736-.152-3.267 1.12-3.417 2.835-.06.703.123 1.348.476 1.904-10.81.365-20.042 10.24-20.677 17.5l43.016 3.764c.634-7.26-6.742-18.587-17.325-20.824"/>
        <path id="tray-highlight" fill="#FFF" d="M4596.808-862.775c-1.743-4.045-5.163-7.707-9.386-10.046-.56-.31-.76-1.01-.446-1.56.313-.552 1.02-.75 1.58-.44 4.66 2.583 8.447 6.647 10.386 11.15.25.583-.023 1.256-.613 1.503-.168.07-.344.098-.514.09-.43-.023-.83-.28-1.008-.698z"/>
      </g>
    </svg>`
  )
}

function getFeedbackScore(cb) {
  // This needs to call the feedback score API endpoint instead
  var req = makeCORSRequest('https://api.resmio.com/v1/facility/' + facilityId + '/availability?date__gte=2016-03-01')
  req.onload = function onload() {
    if (req.status === 404) {
      return new Error('not found')
    } else {
      cb(req.response)
    }
  }
  req.send()
}

// Adapted from the third party JS book
function makeCORSRequest(url) {
  if (typeof XMLHttpRequest === "undefined") {
    return null;
  }

  var xhr = new XMLHttpRequest()
  if ("withCredentials" in xhr) {                    // Browsers supporting CORS
    xhr.open('GET', url, true)
  }
  else if (typeof XDomainRequest !== "undefined") {  // IE with CORS support
    xhr = new XDomainRequest();
    xhr.open('GET', url);
  }
  else {                                             // No CORS support
    xhr = null
  }
  return xhr;
}

function initialize() {
  getFeedbackScore(function(res) { console.log(res)})
  replaceElement()
}

ready(initialize)
